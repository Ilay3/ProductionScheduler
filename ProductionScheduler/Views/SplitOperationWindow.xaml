<!-- File: Views/SplitOperationWindow.xaml - Исправленная версия -->
<Window x:Class="ProductionScheduler.Views.SplitOperationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:ProductionScheduler.Converters"
        Title="Разделение операции/задания" Height="500" Width="700" 
        WindowStartupLocation="CenterOwner" ResizeMode="NoResize">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
    </Window.Resources>
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <TextBlock Grid.Row="0" Text="🔧 Разделение операции на несколько частей" 
                   FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

        <!-- Тип разделения -->
        <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Padding="10" Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="Тип разделения:" FontWeight="Bold" Margin="0,0,0,10"/>
                <RadioButton IsChecked="{Binding CreateSeparateTasks, Converter={StaticResource InverseBooleanConverter}}" 
                             Content="Разделить в рамках одного задания (этапы)" Margin="0,0,0,5"/>
                <RadioButton IsChecked="{Binding CreateSeparateTasks}" 
                             Content="✨ Создать отдельные задания (рекомендуется)" FontWeight="Bold" Foreground="Green"/>
                <TextBlock Text="При создании отдельных заданий вы получите независимые задачи, которые легче отслеживать и управлять" 
                           FontStyle="Italic" Foreground="Gray" Margin="20,5,0,0" TextWrapping="Wrap"/>
            </StackPanel>
        </Border>

        <!-- Настройки разделения -->
        <Border Grid.Row="2" BorderBrush="LightGray" BorderThickness="1" Padding="10" Margin="0,0,0,15">
            <StackPanel>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                        <TextBlock Text="Общее количество:" Margin="0,0,0,5" FontWeight="Bold"/>
                        <TextBox Text="{Binding TotalQuantity}" IsReadOnly="True" Background="LightGray" FontWeight="Bold"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="5,0">
                        <TextBlock Text="Количество частей:" Margin="0,0,0,5" FontWeight="Bold"/>
                        <TextBox Text="{Binding NumberOfParts, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Margin="10,0,0,0">
                        <TextBlock Text="Примерно по (шт.):" Margin="0,0,0,5" FontWeight="Bold"/>
                        <TextBox Text="{Binding QuantityPerPart, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                </Grid>

                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <Button Content="+ Добавить часть" Command="{Binding AddPartCommand}" Width="120" Margin="0,0,10,0"/>
                    <TextBlock Text="💡 Вы можете добавлять или убирать части по необходимости" 
                               VerticalAlignment="Center" FontStyle="Italic" Foreground="Gray"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Список частей -->
        <GroupBox Grid.Row="3" Header="📋 Настройка частей" Margin="0,0,0,15">
            <DataGrid ItemsSource="{Binding SplitParts}" AutoGenerateColumns="False" CanUserAddRows="False" 
                      CanUserDeleteRows="False" GridLinesVisibility="Horizontal" HeadersVisibility="Column">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="№ Части" Binding="{Binding PartNumber}" Width="80" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Количество (шт.)" Binding="{Binding Quantity}" Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="Foreground" Value="Blue"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn Header="Назначенный станок" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox ItemsSource="{Binding AvailableMachines}"
                                          SelectedItem="{Binding SelectedMachine, UpdateSourceTrigger=PropertyChanged}"
                                          DisplayMemberPath="Name"
                                          Margin="5"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="🗑️ Удалить" 
                                        Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.RemovePartCommand}"
                                        CommandParameter="{Binding}" 
                                        Width="70"
                                        ToolTip="Удалить эту часть"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedMachine}" Value="{x:Null}">
                                <Setter Property="Background" Value="LightCoral"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
            </DataGrid>
        </GroupBox>

        <!-- Кнопки -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="✅ Разделить" Command="{Binding SplitCommand}" Width="100" Height="35" 
                    Margin="0,0,10,0" FontWeight="Bold"/>
            <Button Content="❌ Отмена" Command="{Binding CancelCommand}" Width="100" Height="35"/>
        </StackPanel>
    </Grid>
</Window>